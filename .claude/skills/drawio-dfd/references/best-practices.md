# draw.io ベストプラクティス＆Tips

## 目次
1. [Claude Code向けTips（重要）](#claude-code向けtips重要)
2. [図の設計原則](#図の設計原則)
3. [レイアウトガイドライン](#レイアウトガイドライン)
4. [品質チェックリスト](#品質チェックリスト)

---

## Claude Code向けTips（重要）

### フォント設定の罠

`defaultFontFamily`だけでは不十分。各テキスト要素に`fontFamily`を明示する必要がある。

```xml
<!-- 悪い例: fontFamilyが未指定 -->
<mxCell style="text;html=1;fontSize=18;" />

<!-- 良い例: fontFamilyを明示 -->
<mxCell style="text;html=1;fontSize=18;fontFamily=Noto Sans JP;" />
```

### フォントサイズの推奨

PDF/スライド出力時は標準の1.5倍（18px程度）を推奨。

```xml
<!-- デフォルト12pxは小さすぎることが多い -->
<mxCell style="text;html=1;fontSize=18;fontFamily=Noto Sans JP;" />
```

### 日本語テキストの幅

日本語1文字あたり約30-40pxを確保。幅が狭いと意図しない改行が発生。

```xml
<!-- 悪い例: 幅が狭すぎる -->
<mxGeometry width="100" height="30" />  <!-- 「シンプルなフロー図」が折り返す -->

<!-- 良い例: 十分な幅 -->
<mxGeometry width="300" height="30" />
```

### 矢印は最背面に配置

XMLの記述順が描画順。矢印を先に記述して最背面に。

```xml
<root>
  <mxCell id="0"/>
  <mxCell id="1" parent="0"/>
  
  <!-- 1. 矢印を先に記述（最背面） -->
  <mxCell id="arrow_1" style="edgeStyle=..." edge="1" ... />
  
  <!-- 2. ボックスを後に記述（前面） -->
  <mxCell id="box_1" style="rounded=1;..." vertex="1" ... />
</root>
```

### 矢印とラベルの被り防止

矢印とラベルは最低20px以上離す。

```xml
<!-- 矢印がY=220の場合、ラベルはY=180など十分離す -->
<mxCell id="label" value="処理" ...>
  <mxGeometry x="310" y="180" width="60" height="20" />
</mxCell>
```

### テキスト要素への矢印接続

`exitY/entryY`が効かない場合は座標を明示。

```xml
<!-- 良い例: 明示的に座標を指定 -->
<mxCell id="arrow" style="..." edge="1" parent="1">
  <mxGeometry relative="1" as="geometry">
    <mxPoint x="190" y="300" as="sourcePoint"/>
    <mxPoint x="490" y="300" as="targetPoint"/>
  </mxGeometry>
</mxCell>
```

### page属性の設定

PNG出力時に透明背景を使う場合は`page="0"`を設定。

```xml
<mxGraphModel ... page="0" background="none">
```

---

## 図の設計原則

### 1. 目的を明確にする

作図前に決めること：
- この図で何を伝えたいのか？
- 誰が見る図か？（開発者/PM/経営層/外部ステークホルダー）
- どの粒度が適切か？

### 2. 対象者に合わせた詳細度

| 対象者 | 推奨する図の種類 | 詳細度 |
|--------|-----------------|--------|
| 経営層/ビジネス | コンテキスト図、ブロック図 | 低 |
| PM/アーキテクト | システム構成図、データフロー図 | 中 |
| 開発者 | コンポーネント図、シーケンス図 | 高 |
| インフラ/運用 | デプロイ図、ネットワーク図 | 高 |

### 3. 一貫性を保つ

- 同じ種類の要素には同じ色・形を使用
- フォントサイズ・スタイルを統一
- 矢印の種類（実線/破線）に意味を持たせる
- 凡例（レジェンド）を追加する

### 4. 正確性を犠牲にしない

- PaaSサービスがプライベートエンドポイント経由ならサブネット外に描く
- 実際の構成と異なる図は混乱を招く
- 抽象化しすぎて誤解を生まないよう注意

### 5. レイヤー分け

1つの図に詰め込みすぎない。複数ページに分割：
- コンテキスト図 → コンテナ図 → コンポーネント図
- 概要 → 詳細のプログレッシブ・ディスクロージャー

---

## レイアウトガイドライン

### 基本フロー

**左→右**または**上→下**の一貫した流れを維持。

```
[入力] → [処理1] → [処理2] → [出力]
```

### グリッドとスペーシング

- グリッドサイズ: 10px
- 要素間の最小距離: 40-60px
- 同種要素の垂直間隔: 80-100px
- グループ内のパディング: 20-30px

### グループ化の原則

```
AWS Cloud (最外層)
├── VPC
│   ├── Public Subnet
│   │   └── サービス群
│   └── Private Subnet
│       └── サービス群
└── マネージドサービス (VPC外)
```

### 接続線のルール

| 種類 | スタイル | 用途 |
|------|---------|------|
| 実線 | `dashed=0` | 同期通信、主要フロー |
| 破線 | `dashed=1` | 非同期通信、オプションフロー |
| 太線 | `strokeWidth=2` | 強調、メインパス |

### ラベル配置

- 矢印のラベルは線の上または横に配置
- 要素のラベルは要素の下に配置（AWSアイコンの場合）
- ラベルと要素/線が重ならないよう注意

---

## 品質チェックリスト

### 作図前
- [ ] 図の目的を定義した
- [ ] 対象者を特定した
- [ ] 適切な図の種類を選択した

### 作図中
- [ ] 全テキスト要素に`fontFamily`を設定
- [ ] フォントサイズは十分か（18px以上推奨）
- [ ] 日本語テキストの幅は十分か（1文字30-40px）
- [ ] 矢印は最背面に配置（XML記述順）
- [ ] 矢印とラベルが重なっていない（20px以上離す）
- [ ] 色・スタイルに一貫性がある
- [ ] 凡例を追加した（必要な場合）

### 作図後
- [ ] PNG/PDFで出力確認した
- [ ] テキストが意図しない改行をしていない
- [ ] 矢印が他の要素と重なっていない
- [ ] ラベルがすべて読める
- [ ] メタデータ（タイトル、更新日）を追加

### AWS構成図の追加チェック
- [ ] 正しいAWSアイコンを使用している
- [ ] グループ（VPC/Subnet/AZ）が適切
- [ ] セキュリティグループの境界が明確
- [ ] データフローの方向が正しい
