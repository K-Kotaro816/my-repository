# フェーズ5: 間取り画像アップロード - 操作手順書

## 概要

間取り図の画像（写真やスキャン画像）をアップロードし、エディタキャンバスの背景として表示する機能です。画像は部屋サイズに合わせてスケーリングされ、家具配置の参考背景として機能します。

## 前提条件

- アプリケーションが起動していること（`docker-compose up`）
- ユーザーがログイン済みであること
- プロジェクトが作成済みであること

## 操作手順

### 1. 間取り画像のアップロード

1. ダッシュボードからプロジェクトを選択してエディタを開く
2. 画面右上に「間取り図」パネルが表示される
3. 「間取り画像をアップロード」ボタンをクリック
4. ファイル選択ダイアログから画像ファイルを選択
   - 対応形式: JPEG, PNG, WebP
   - 最大サイズ: 10MB
5. アップロード完了後、自動的に「画像」モードに切り替わる
6. キャンバスの背景に画像が半透明で表示される

### 2. モード切り替え

間取り図パネルの上部にある2つのボタンでモードを切り替えます。

#### 壁描画モード（デフォルト）
- 壁描画ツールが使用可能
- 画像は非表示
- 家具レイヤーは常に表示

#### 画像モード
- アップロード済み画像が背景に表示（opacity 0.6）
- 壁描画ツールは非表示
- 家具レイヤーは常に表示
- 画像がアップロードされていない場合は選択不可（ボタンが無効化）

### 3. 画像の削除

1. 間取り図パネルで「画像を削除」ボタンをクリック
2. 画像が削除され、自動的に「壁描画」モードに戻る

### 4. 画像の差し替え

1. 現在の画像を削除
2. 新しい画像をアップロード

## レイヤー構成

キャンバスは以下の順序でレイヤーが重なります：

| 順序 | レイヤー | 表示条件 |
|------|---------|---------|
| 1 | グリッド | 常に表示 |
| 2 | 間取り画像 | 画像モード時のみ |
| 3 | 壁描画 | 壁描画モード時のみ |
| 4 | 家具 | 常に表示 |

## 注意事項

- 画像は部屋の実寸サイズ（幅 x 高さ）に引き伸ばされて表示されます
- 画像の縦横比は部屋のサイズに合わせて変形されます
- 正確なレイアウトのためには、部屋サイズに近い縦横比の画像を使用してください
- 家具パレットが開いている間は、間取り図パネルは非表示になります
- 画像モードでも家具の配置・移動・回転は可能です

## エラーと対処

| エラー | 原因 | 対処 |
|--------|------|------|
| アップロードが失敗する | ファイルサイズが10MBを超過 | 画像を圧縮・縮小してから再アップロード |
| アップロードが失敗する | 非対応のファイル形式 | JPEG, PNG, WebP形式に変換 |
| 画像が表示されない | ネットワークエラー | ページをリロードして再試行 |
