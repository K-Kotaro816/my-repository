# フェーズ4: 衝突検出 - 操作手順書

## 前提条件
- フェーズ3までのセットアップが完了していること
- Docker環境が起動していること（`docker-compose up`）
- プロジェクトが1つ以上作成されていること

## 1. 衝突検出の動作

### 衝突とは
- 2つ以上の家具が重なっている状態
- 配置は阻止されず、視覚的な警告のみ表示される

### 衝突の視覚表示
- **赤枠**: 衝突中の家具は赤い枠線（#ef4444）で表示される
- **赤オーバーレイ**: 衝突中の家具に半透明の赤いオーバーレイが重ねて表示される
- **通常表示**: 衝突が解消されると、通常の枠線色に戻る

## 2. 衝突が検出されるタイミング

### ドラッグ中（リアルタイム）
1. 家具をドラッグして移動する
2. ドラッグ中に他の家具と重なると、即座に赤表示になる
3. 重なりが解消されると、即座に通常表示に戻る

### 配置時
1. 家具カタログから家具を選択し、キャンバス上に配置する
2. 配置位置に他の家具がある場合、赤表示になる

### 回転時
1. 家具を選択し、プロパティパネルの「90°回転」ボタンをクリック
2. 回転後に他の家具と重なる場合、赤表示になる

### 削除時
1. 衝突中の家具の一方を削除する
2. 残りの家具の衝突が解消され、通常表示に戻る

## 3. プロパティパネルの衝突警告

- 衝突中の家具を選択すると、プロパティパネルに警告バナーが表示される
- 「⚠ 他の家具と重なっています」というメッセージ
- 赤い背景のバナーで視覚的に目立つ

## 4. 衝突検出アルゴリズム

- SAT（Separating Axis Theorem / 分離軸定理）を使用
- 回転した矩形同士の正確な衝突判定に対応
- 0°、90°、180°、270°の回転に対応（将来的に任意角度にも拡張可能）

## 5. 注意事項

- 衝突検出は配置を阻止しません（警告のみ）
- 壁との衝突は検出しません（家具同士のみ）
- ズーム/パン操作中も衝突表示は正しく維持されます
- ページリロード後も既存の重なりが再検出されます
